/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 30-may.-2021 14:51:40 				*/
/*  DBMS       : SQL Server 2012 						*/
/* ---------------------------------------------------- */

/* Drop Foreign Key Constraints */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_CLIENTE_PERSONA]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [CLIENTE] DROP CONSTRAINT [FK_CLIENTE_PERSONA]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_ID_ORDEN]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [DETALLE_ORDEN] DROP CONSTRAINT [FK_ID_ORDEN]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_ID_PRODUCTO]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [DETALLE_ORDEN] DROP CONSTRAINT [FK_ID_PRODUCTO]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_ORDEN_VENTA_METODO_PAGO]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [ORDEN_VENTA] DROP CONSTRAINT [FK_ORDEN_VENTA_METODO_PAGO]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_ORDEN_VENTA_ORDEN]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [ORDEN_VENTA] DROP CONSTRAINT [FK_ORDEN_VENTA_ORDEN]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_PERSONA_DIRECCION]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [PERSONA] DROP CONSTRAINT [FK_PERSONA_DIRECCION]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_PRODUCTO_CATEGORIA]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [PRODUCTO] DROP CONSTRAINT [FK_PRODUCTO_CATEGORIA]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_TARJETA_METODO_PAGO]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Tarjeta] DROP CONSTRAINT [FK_TARJETA_METODO_PAGO]
GO

/* Drop Tables */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[CATEGORIA]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [CATEGORIA]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[CLIENTE]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [CLIENTE]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[DETALLE_ORDEN]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [DETALLE_ORDEN]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[DIRECCION]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [DIRECCION]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[METODO_PAGO]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [METODO_PAGO]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[ORDEN]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [ORDEN]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[ORDEN_VENTA]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [ORDEN_VENTA]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[PERSONA]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [PERSONA]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[PRODUCTO]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [PRODUCTO]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Tarjeta]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Tarjeta]
GO

/* Create Tables */

CREATE TABLE [CATEGORIA]
(
	[ID_CATEGORIA] int NOT NULL IDENTITY (1, 1),
	[NOMBRE] varchar(50) NOT NULL
)
GO

CREATE TABLE [CLIENTE]
(
	[ID_CLIENTE] int NOT NULL IDENTITY (1, 1),
	[ID_PERSONA] int NOT NULL
)
GO

CREATE TABLE [DETALLE_ORDEN]
(
	[ID_DETALLE_ORDEN] int NOT NULL IDENTITY (1, 1),
	[CANTIDAD] varchar(50) NOT NULL,
	[ID_ORDEN] int NOT NULL,
	[ID_PRODUCTO] int NOT NULL
)
GO

CREATE TABLE [DIRECCION]
(
	[ID_DIRECCION] int NOT NULL IDENTITY (1, 1),
	[ALTURA] varchar(50) NOT NULL,
	[CALLE] varchar(50) NOT NULL,
	[CODIGO_POSTAL] varchar(50) NOT NULL,
	[LOCALIDAD] varchar(50) NOT NULL,
	[PROVINCIA] varchar(50) NOT NULL
)
GO

CREATE TABLE [METODO_PAGO]
(
	[ID_METODO_PAGO] int NOT NULL IDENTITY (1, 1),
	[TIPO] varchar(50) NOT NULL
)
GO

CREATE TABLE [ORDEN]
(
	[ID_ORDEN] int NOT NULL IDENTITY (1, 1),
	[FECHA] datetime NOT NULL
)
GO

CREATE TABLE [ORDEN_VENTA]
(
	[ID_ORDEN_VENTA] int NOT NULL IDENTITY (1, 1),
	[ID_ORDEN] int NOT NULL,
	[ID_METODO_PAGO] int NOT NULL
)
GO

CREATE TABLE [PERSONA]
(
	[ID_PERSONA] int NOT NULL IDENTITY (1, 1),
	[APELLIDO] varchar(50) NOT NULL,
	[DNI] varchar(50) NOT NULL,
	[NOMBRE] varchar(50) NOT NULL,
	[ID_DIRECCION] int NOT NULL
)
GO

CREATE TABLE [PRODUCTO]
(
	[ID_PRODUCTO] int NOT NULL IDENTITY (1, 1),
	[NOMBRE] varchar(50) NOT NULL,
	[PRECIO_COMPRA] float NOT NULL,
	[PRECIO_VENTA] float NOT NULL,
	[ID_CATEGORIA] int NOT NULL
)
GO

CREATE TABLE [TARJETA]
(
	[ID_TARJETA] int NOT NULL IDENTITY (1, 1),
	[CVC] varchar(50) NOT NULL,
	[FECHA_VENCIMIENTO] varchar(50) NOT NULL,
	[NOMBRE_TARJETA] varchar(50) NOT NULL,
	[NUMERO_TARJETA] int NOT NULL,
	[ID_METODO_PAGO] int NOT NULL
)
GO

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE [CATEGORIA] 
 ADD CONSTRAINT [PK_CATEGORIA]
	PRIMARY KEY CLUSTERED ([ID_CATEGORIA] ASC)
GO

ALTER TABLE [CLIENTE] 
 ADD CONSTRAINT [PK_CLIENTE]
	PRIMARY KEY CLUSTERED ([ID_CLIENTE] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_CLIENTE_PERSONA] 
 ON [CLIENTE] ([ID_PERSONA] ASC)
GO

ALTER TABLE [DETALLE_ORDEN] 
 ADD CONSTRAINT [PK_ID_DETALLE_ORDEN]
	PRIMARY KEY CLUSTERED ([ID_DETALLE_ORDEN] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_ID_PRODUCTO] 
 ON [DETALLE_ORDEN] ([ID_PRODUCTO] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_ID_ORDEN] 
 ON [DETALLE_ORDEN] ()
GO

ALTER TABLE [DIRECCION] 
 ADD CONSTRAINT [PK_DIRECCION]
	PRIMARY KEY CLUSTERED ([ID_DIRECCION] ASC)
GO

ALTER TABLE [METODO_PAGO] 
 ADD CONSTRAINT [PK_METODO_PAGO]
	PRIMARY KEY CLUSTERED ([ID_METODO_PAGO] ASC)
GO

ALTER TABLE [ORDEN] 
 ADD CONSTRAINT [PK_ORDEN]
	PRIMARY KEY CLUSTERED ([ID_ORDEN] ASC)
GO

ALTER TABLE [ORDEN_VENTA] 
 ADD CONSTRAINT [PK_ORDEN_VENTA]
	PRIMARY KEY CLUSTERED ([ID_ORDEN_VENTA] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_ORDEN_VENTA_METODO_PAGO] 
 ON [ORDEN_VENTA] ([ID_METODO_PAGO] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_ORDEN_VENTA_ORDEN] 
 ON [ORDEN_VENTA] ([ID_ORDEN] ASC)
GO

ALTER TABLE [PERSONA] 
 ADD CONSTRAINT [PK_PERSONA]
	PRIMARY KEY CLUSTERED ([ID_PERSONA] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_PERSONA_DIRECCION] 
 ON [PERSONA] ([ID_DIRECCION] ASC)
GO

ALTER TABLE [PRODUCTO] 
 ADD CONSTRAINT [PK_PRODUCTO]
	PRIMARY KEY CLUSTERED ([ID_PRODUCTO] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_PRODUCTO_CATEGORIA] 
 ON [PRODUCTO] ([ID_CATEGORIA] ASC)
GO

ALTER TABLE [Tarjeta] 
 ADD CONSTRAINT [PK_TARJETA]
	PRIMARY KEY CLUSTERED ([ID_TARJETA] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_TARJETA_METODO_PAGO] 
 ON [Tarjeta] ([ID_METODO_PAGO] ASC)
GO

/* Create Foreign Key Constraints */

ALTER TABLE [CLIENTE] ADD CONSTRAINT [FK_CLIENTE_PERSONA]
	FOREIGN KEY ([ID_PERSONA]) REFERENCES [PERSONA] ([ID_PERSONA]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [DETALLE_ORDEN] ADD CONSTRAINT [FK_ID_ORDEN]
	FOREIGN KEY ([ID_ORDEN]) REFERENCES [ORDEN] ([ID_ORDEN]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [DETALLE_ORDEN] ADD CONSTRAINT [FK_ID_PRODUCTO]
	FOREIGN KEY ([ID_PRODUCTO]) REFERENCES [PRODUCTO] ([ID_PRODUCTO]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [ORDEN_VENTA] ADD CONSTRAINT [FK_ORDEN_VENTA_METODO_PAGO]
	FOREIGN KEY ([ID_METODO_PAGO]) REFERENCES [METODO_PAGO] ([ID_METODO_PAGO]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [ORDEN_VENTA] ADD CONSTRAINT [FK_ORDEN_VENTA_ORDEN]
	FOREIGN KEY ([ID_ORDEN]) REFERENCES [ORDEN] ([ID_ORDEN]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [PERSONA] ADD CONSTRAINT [FK_PERSONA_DIRECCION]
	FOREIGN KEY ([ID_DIRECCION]) REFERENCES [DIRECCION] ([ID_DIRECCION]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [PRODUCTO] ADD CONSTRAINT [FK_PRODUCTO_CATEGORIA]
	FOREIGN KEY ([ID_CATEGORIA]) REFERENCES [CATEGORIA] ([ID_CATEGORIA]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Tarjeta] ADD CONSTRAINT [FK_TARJETA_METODO_PAGO]
	FOREIGN KEY ([ID_METODO_PAGO]) REFERENCES [METODO_PAGO] ([ID_METODO_PAGO]) ON DELETE No Action ON UPDATE No Action
GO
